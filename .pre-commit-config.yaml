# Pre-commit hooks for Family Medical App
# Run: pre-commit install
# Manual run: pre-commit run --all-files

repos:
  # Swift code formatting
  - repo: https://github.com/nicklockwood/SwiftFormat
    rev: 0.59.1  # Latest as of Jan 2026
    hooks:
      - id: swiftformat
        args:
          - --config
          - .swiftformat

  # Swift linting
  - repo: https://github.com/realm/SwiftLint
    rev: 0.63.2  # Latest as of Jan 2026
    hooks:
      - id: swiftlint
        args:
          - --strict
          - --config
          - .swiftlint.yml

  # Rust formatting
  - repo: https://github.com/doublify/pre-commit-rust
    rev: v1.0
    hooks:
      - id: fmt
        name: rustfmt (opaque-swift)
        args: ["--manifest-path", "opaque-swift/Cargo.toml", "--"]
      - id: fmt
        name: rustfmt (backend-rust)
        args: ["--manifest-path", "backend-rust/Cargo.toml", "--"]
      - id: cargo-check
        name: clippy (opaque-swift)
        entry: cargo clippy
        args: ["--manifest-path", "opaque-swift/Cargo.toml", "--", "-D", "warnings", "-D", "clippy::unwrap_used", "-D", "clippy::expect_used"]
      - id: cargo-check
        name: clippy (backend-rust)
        entry: cargo clippy
        args: ["--manifest-path", "backend-rust/Cargo.toml", "--target", "wasm32-unknown-unknown", "--", "-D", "warnings", "-D", "clippy::unwrap_used", "-D", "clippy::expect_used"]

  # GitHub Actions workflow linting
  - repo: https://github.com/rhysd/actionlint
    rev: v1.7.9  # Latest as of Dec 2025
    hooks:
      - id: actionlint

  # Shell script linting
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.11.0.1  # Latest as of Dec 2025
    hooks:
      - id: shellcheck

  # General file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0  # Latest as of Dec 2025
    hooks:
      - id: trailing-whitespace
        exclude: '\.md$'
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: ['--maxkb=1000']  # Max 1MB files
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: mixed-line-ending
        args: ['--fix=lf']
      - id: detect-private-key  # Security: prevent committing private keys
      - id: no-commit-to-branch
        args: ['--branch', 'main']

  # Markdown linting
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.47.0  # Latest as of Dec 2025
    hooks:
      - id: markdownlint
        args: ['--fix', '--config', '.markdownlint.json']
        exclude: '^(docs/adr/adr-template\.md|CLAUDE\.md)$'

  # Backup schema validation
  - repo: local
    hooks:
      - id: validate-backup-schema
        name: Validate backup JSON Schema
        entry: ./scripts/validate-backup-schema.sh
        language: script
        files: |
          (?x)^(
            docs/schemas/backup-v1\.json|
            ios/FamilyMedicalApp/FamilyMedicalApp/Models/Backup/.*\.swift|
            ios/FamilyMedicalApp/FamilyMedicalApp/Services/Backup/BackupSchemaValidator\.swift
          )$
        pass_filenames: false

# Global settings
default_language_version:
  python: python3

ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: monthly
  skip: []
  submodules: false
